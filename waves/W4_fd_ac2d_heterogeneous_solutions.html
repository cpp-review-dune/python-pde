
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>33. Acoustic Waves 2D - Heterogeneous case &#8212; PDE tutorial</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'waves/W4_fd_ac2d_heterogeneous_solutions';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="34. Acoustic Waves 2D - Homogeneous case" href="W4_fd_ac2d_homogeneous.html" />
    <link rel="prev" title="32. Acoustic Waves 1D - Optimal Operators" href="W4_ac1d_optimal_operators.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Jun 03, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="PDE tutorial - Home"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="PDE tutorial - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    PDE Tutorial
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The Finite Difference Method</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../notes/pde.html">1. Partial Differential Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/fda.html">2. Finite-Difference Approximations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/elliptic.html">3. Elliptic Partial Differential Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/octave.html">4. octave</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pystencils.html">5. pystencils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jax/jax.html">6. Introduction to JAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jax/finitediffx.html">7. finitediffx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jax/kernex.html">8. kernex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../py-pde.html">9. <code class="docutils literal notranslate"><span class="pre">py-pde</span></code> tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../findiff.html">10. <code class="docutils literal notranslate"><span class="pre">findiff</span></code> tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../symbolic-findiff.html">11. Symbolic <code class="docutils literal notranslate"><span class="pre">findiff</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../solve-findiff.html">12. Solve with <code class="docutils literal notranslate"><span class="pre">findiff</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../advectionper.html">13. <code class="docutils literal notranslate"><span class="pre">AdvectionPer.m</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../diffusioncrancknic.html">14. <code class="docutils literal notranslate"><span class="pre">DiffusionCrankNic.m</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../advection-pystencils.html">15. Advection pystencils example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../petsc.html">16. 1D heat diffusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The Finite Volume Method</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../clawpack.html">1D advection equation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The Mimetic Finite Difference Method</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../mimetic/mole.html">mole</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Simulating Fluid Flows Using Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture1.html">17. Introduction to Computational Fluid Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture2.html">18. Finite Differences - First Derivative</a></li>

<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture3.html">20. Finite differences in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture4.html">21. Second derivative - 1D heat conduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture5.html">22. Introduction to Finite Volume Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture6.html">23. CFD Relevant Python Statements | While | For</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture7.html">24. Conduction Visualization Python Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture8.html">25. Generalized FVM Formulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fluids/lecture10.html">26. 0</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Computers, Waves, Simulations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="W2_P1.html">27. First Derivative</a></li>
<li class="toctree-l1"><a class="reference internal" href="W2_P2.html">28. Second Derivative</a></li>
<li class="toctree-l1"><a class="reference internal" href="W2_P3.html">29. High-Order Taylor Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="W3_P1_Gaussian.html">30. Acoustic Waves 1D I</a></li>
<li class="toctree-l1"><a class="reference internal" href="W3_P2_Gaussian_analytical.html">31. Acoustic Waves 1D II</a></li>
<li class="toctree-l1"><a class="reference internal" href="W4_ac1d_optimal_operators.html">32. Acoustic Waves 1D - Optimal Operators</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">33. Acoustic Waves 2D - Heterogeneous case</a></li>
<li class="toctree-l1"><a class="reference internal" href="W4_fd_ac2d_homogeneous.html">34. Acoustic Waves 2D - Homogeneous case</a></li>
<li class="toctree-l1"><a class="reference internal" href="W4_fd_advection_1d.html">35. Advection equation 1D</a></li>
<li class="toctree-l1"><a class="reference internal" href="W4_fd_elastic1d_staggered_solution.html">36. Grid-Staggering Elastic 1D</a></li>
<li class="toctree-l1"><a class="reference internal" href="W5_ps_cheby_derivative_solution.html">37. The Pseudo-Spectral Method - Numerical Derivatives based on a Derivative Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="W5_ps_cheby_elastic_1d_solution.html">38. The Pseudo-Spectral Method - Elastic Wave Equation 1D</a></li>
<li class="toctree-l1"><a class="reference internal" href="W5_ps_fourier_acoustic_1d.html">39. The Pseudo-Spectral Method - Acoustic Waves in 1D</a></li>
<li class="toctree-l1"><a class="reference internal" href="W5_ps_fourier_acoustic_2d.html">40. The Pseudo-Spectral Method - Acoustic Waves in 2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="W6_fe_static_elasticity.html">41. The Finite Element Method - Static Elasticity</a></li>
<li class="toctree-l1"><a class="reference internal" href="W7_fe_elastic_1d_solution.html">42. The Finite Element Method - Elastic Wave Equation 1D</a></li>
<li class="toctree-l1"><a class="reference internal" href="W8_se_Lagrange_interpolation_simple.html">43. The Spectral Element Method - Interpolation with Lagrange Polynomials</a></li>
<li class="toctree-l1"><a class="reference internal" href="W8_se_numerical_integration_GLL.html">44. The Spectral Element Method - Numerical Integration - The Gauss-Lobatto-Legendre approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="W9_se_hetero_1d_solution.html">45. Spectral Element Method - Elastic Wave Equation 1D, Heterogeneous case</a></li>
<li class="toctree-l1"><a class="reference internal" href="W9_se_homo_1d_solution.html">46. Spectral Element Method - Elastic Wave Equation 1D - Homogeneous Case</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Differential equations and Fourier analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../TMA4125/fourier_series_supplemental_material.html">47. Fourier series: supplemental material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TMA4125/LagrangeInterpolation.html">48. Polynomial interpolation: Lagrange interpolation</a></li>


<li class="toctree-l1"><a class="reference internal" href="../TMA4125/RungeKuttaNuMeODE.html">51. Numerical solution of ordinary differential equations: High order Runge-Kutta methods</a></li>

<li class="toctree-l1"><a class="reference internal" href="../TMA4125/TwoPointBoundaryProblems.html">53. Finite difference methods for two-point value problems</a></li>



<li class="toctree-l1"><a class="reference internal" href="../TMA4125/CompositeQuadrature.html">57. Numerical integration: Part II</a></li>



<li class="toctree-l1"><a class="reference internal" href="../TMA4125/GaussQuadrature.html">61. Numerical integration: Part IV</a></li>


<li class="toctree-l1"><a class="reference internal" href="../TMA4125/lecture_01_introduction.html">64. Introduction to TMA4125</a></li>


<li class="toctree-l1"><a class="reference internal" href="../TMA4125/SimpleCovidModel.html">67. A simple epidemic model for Covid 19 and its numerical solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TMA4125/ErrorAnalysisNuMeODE.html">68. Numerical solution of ordinary differential equations: One step methods</a></li>

<li class="toctree-l1"><a class="reference internal" href="../TMA4125/Introduction.html">70. Introduction to TMA4125</a></li>


<li class="toctree-l1"><a class="reference internal" href="../TMA4125/NewtonInterpolation.html">73. Polynomial interpolation: Newton interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TMA4125/SimpleQuadrature.html">74. Numerical integration</a></li>



<li class="toctree-l1"><a class="reference internal" href="../TMA4125/ErrorTheoryInterpolation.html">78. Polynomial interpolation: Error theory</a></li>

<li class="toctree-l1"><a class="reference internal" href="../TMA4125/IntroductionNuMeODE.html">80. Numerical solution of ordinary differential equations: Euler’s and Heun’s method</a></li>





<li class="toctree-l1"><a class="reference internal" href="../TMA4125/NumericalMethodsHeatEquation.html">86. Numerical methods for the heat equation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Finite Difference Computing with PDEs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../hplgit/vibration.html">87. Lecture 3</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">End Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cpp-review-dune/python-pde" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cpp-review-dune/python-pde/edit/main/pde-book/waves/W4_fd_ac2d_heterogeneous_solutions.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cpp-review-dune/python-pde/issues/new?title=Issue%20on%20page%20%2Fwaves/W4_fd_ac2d_heterogeneous_solutions.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/waves/W4_fd_ac2d_heterogeneous_solutions.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Acoustic Waves 2D - Heterogeneous case</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-equations">33.1. Basic Equations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">33.1.1. 1. Getting started</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability">33.1.2. 2. Stability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-order-operators">33.1.3. 3. High-order operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-anisotropy">33.1.4. 4. Numerical anisotropy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#heterogeneous-models">33.1.5. 5. Heterogeneous models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#source-receiver-reciprocity">33.1.6. 6. Source-receiver reciprocity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-reversal">33.1.7. 7. Time reversal</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div style='background-image: url("./title01.png") ; padding: 0px ; background-size: cover ; border-radius: 5px ; height: 200px'>
<div style="float: right ; margin: 50px ; padding: 20px ; background: rgba(255 , 255 , 255 , 0.7) ; width: 50% ; height: 150px">
<div style="position: relative ; top: 50% ; transform: translatey(-50%)">
            <div style="font-size: xx-large ; font-weight: 900 ; color: rgba(0 , 0 , 0 , 0.8) ; line-height: 100%">Computers, Waves, Simulations</div>
            <div style="font-size: large ; padding-top: 20px ; color: rgba(0 , 0 , 0 , 0.5)">Finite-Difference Method - Acoustic Waves 2D - Heterogeneous case</div>
        </div>
    </div>
</div><section class="tex2jax_ignore mathjax_ignore" id="acoustic-waves-2d-heterogeneous-case">
<h1><span class="section-number">33. </span>Acoustic Waves 2D - Heterogeneous case<a class="headerlink" href="#acoustic-waves-2d-heterogeneous-case" title="Link to this heading">#</a></h1>
<p>This exercise covers the following aspects:</p>
<ul class="simple">
<li><p>Presenting you with an implementation of the 2D acoustic wave equation</p></li>
<li><p>Allowing you to explore the benefits of using high-order finite-difference operators</p></li>
<li><p>Understanding the concepts of stability (Courant criterion)</p></li>
<li><p>Exploration of numerical dispersion and numerical grid anisotropy</p></li>
<li><p>Changing the earth model and exploring some effects of structural heterogeneities (e.g., fault zones)</p></li>
</ul>
<hr class="docutils" />
<section id="basic-equations">
<h2><span class="section-number">33.1. </span>Basic Equations<a class="headerlink" href="#basic-equations" title="Link to this heading">#</a></h2>
<p>The acoustic wave equation in 2D is
$<span class="math notranslate nohighlight">\(
\ddot{p}(x,z,t) \ = \ c(x,z)^2 (\partial_x^2 p(x,z,t) + \partial_z^2 p(x,z,t)) \ + s(x,z,t)
\)</span>$</p>
<p>and we replace the time-dependent (upper index time, lower indices space) part by</p>
<div class="math notranslate nohighlight">
\[
 \frac{p_{j,k}^{n+1} - 2 p_{j,k}^n + p_{j,k}^{n-1}}{\mathrm{d}t^2} \ = \ c_j^2 ( \partial_x^2 p + \partial_z^2 p) \ + s_{j,k}^n
\]</div>
<p>solving for <span class="math notranslate nohighlight">\(p_{j,k}^{n+1}\)</span>.
The extrapolation scheme is
$$
p_{j,k}^{n+1} \ = \ c_j^2 \mathrm{d}t^2 \left[ \partial_x^2 p + \partial_z^2 p \right]</p>
<ul class="simple">
<li><p>2p_{j,k}^n - p_{j,k}^{n-1} + \mathrm{d}t^2 s_{j,k}^n
$$
The  space derivatives are determined by</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\partial_x^2 p \ = \ \frac{p_{j+1,k}^{n} - 2 p_{j,k}^n + p_{j-1,k}^{n}}{\mathrm{d}x^2}
\]</div>
<div class="math notranslate nohighlight">
\[
\partial_z^2 p \ = \ \frac{p_{j,k+1}^{n} - 2 p_{j,k}^n + p_{j,k-1}^{n}}{\mathrm{d}z^2} 
\]</div>
<hr class="docutils" />
<section id="getting-started">
<h3><span class="section-number">33.1.1. </span>1. Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">#</a></h3>
<p>Relate the time extrapolation loop with the numerical algorithm we developed in the course. Understand the input parameters for the simulation and the plots that are generated. Modify source and receiver locations and observe the effects on the seismograms.</p>
</section>
<section id="stability">
<h3><span class="section-number">33.1.2. </span>2. Stability<a class="headerlink" href="#stability" title="Link to this heading">#</a></h3>
<p>The Courant criterion is defined as <span class="math notranslate nohighlight">\(eps = (v \cdot dt) / dx\)</span> and provides the maximum possible, stable time step, with <span class="math notranslate nohighlight">\(v\)</span> beeing the velocity, <span class="math notranslate nohighlight">\(dt\)</span> the time step and <span class="math notranslate nohighlight">\(dx\)</span> the spatial step. Determine numerically the stability limit of the code as accurately as possible by increasing the time step. Print the max value of the pressure field at each time step and observe the evolution of it in the case of stable and unstable simulations.</p>
</section>
<section id="high-order-operators">
<h3><span class="section-number">33.1.3. </span>3. High-order operators<a class="headerlink" href="#high-order-operators" title="Link to this heading">#</a></h3>
<p>Extend the code by adding the option to use a 5-point difference operator. Compare simulations with the 3-point and 5-point operator. Is the stability limit still the same? Estimate the number of points per wavelength and investigate the accuracy of the simulation by looking for signs of numerical dispersion in the resulting seismograms. The 5-pt weights are: <span class="math notranslate nohighlight">\([-1/12, 4/3, -5/2, 4/3, -1/12]/dx^2\)</span>.</p>
</section>
<section id="numerical-anisotropy">
<h3><span class="section-number">33.1.4. </span>4. Numerical anisotropy<a class="headerlink" href="#numerical-anisotropy" title="Link to this heading">#</a></h3>
<p>Increase the frequency of the wavefield by varying <span class="math notranslate nohighlight">\(f_0\)</span>. Investigate the angular dependence of the wavefield. Why does the wavefield look anisotropic? Which direction is the most accurate and why? What happens if you set the source time function to a spike (zero everywhere except one element with value <span class="math notranslate nohighlight">\(1\)</span>).</p>
</section>
<section id="heterogeneous-models">
<h3><span class="section-number">33.1.5. </span>5. Heterogeneous models<a class="headerlink" href="#heterogeneous-models" title="Link to this heading">#</a></h3>
<p>Now let us explore the power of the finite-difference method by varying the internal structure of the model. Here we can only modify the velocity <span class="math notranslate nohighlight">\(c\)</span> that  can vary at each grid point (any restrictions?). Here are some suggestions: investigate the influence of the structure by analysing the snapshots and the seismograms.</p>
<ul class="simple">
<li><p>Add a low(high) velocity layer near the surface. Put the source at <span class="math notranslate nohighlight">\(z_s=2\)</span>.</p></li>
<li><p>Add a vertical low velocity zone (fault zone) of a certain width (e.g. <span class="math notranslate nohighlight">\(10\)</span> grid points), and discuss the resulting wavefield</p></li>
<li><p>Simulate topography by setting the pressure to <span class="math notranslate nohighlight">\(0\)</span> above the surface. Use a Gaussian hill shape or a random topography.</p></li>
<li><p>etc.</p></li>
</ul>
</section>
<section id="source-receiver-reciprocity">
<h3><span class="section-number">33.1.6. </span>6. Source-receiver reciprocity<a class="headerlink" href="#source-receiver-reciprocity" title="Link to this heading">#</a></h3>
<p>Initialize a strongly heterogeneous 2D velocity model of your choice and simulate waves propagating from an internal source point (<span class="math notranslate nohighlight">\(x_s, z_s\)</span>) to an internal receiver (<span class="math notranslate nohighlight">\(x_r, z_r\)</span>). Show that by reversing source and receiver you obtain the same seismogram.</p>
</section>
<section id="time-reversal">
<h3><span class="section-number">33.1.7. </span>7. Time reversal<a class="headerlink" href="#time-reversal" title="Link to this heading">#</a></h3>
<p>Time reversal. Define in an arbitrary 2D velocity model a source at the centre of the domain an a receiver circle at an appropriate distance around the source. Simulate a wavefield, record it at the receiver ring and store the results. Reverse the synthetic seismograms and inject the as sources at the receiver points. What happens? Do you know examples where this principle is used?</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a configuration step for the exercise. Please run it before the simulation code!</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>Below is the 2D acoustic simulation code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simple finite difference solver</span>
<span class="c1"># Acoustic wave equation  p_tt = c^2 p_xx + src</span>
<span class="c1"># 2-D regular grid</span>

<span class="n">nx</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># grid points in x - 500</span>
<span class="n">nz</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># grid points in z - 500</span>
<span class="n">nt</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># number of time steps</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># grid increment in x - 1</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># Time step</span>
<span class="n">c0</span> <span class="o">=</span> <span class="mf">3000.0</span>  <span class="c1"># velocity (can be an array) - 580</span>
<span class="n">isx</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># source index x - 250</span>
<span class="n">isz</span> <span class="o">=</span> <span class="n">nz</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># source index z - 250</span>
<span class="n">ist</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># shifting of source time function</span>
<span class="n">f0</span> <span class="o">=</span> <span class="mf">50.0</span>  <span class="c1"># dominant frequency of source (Hz)</span>
<span class="n">isnap</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># snapshot frequency</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">f0</span>  <span class="c1"># dominant period</span>
<span class="n">nop</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># length of operator</span>

<span class="c1"># Model type, available are &quot;homogeneous&quot;, &quot;fault_zone&quot;,</span>
<span class="c1"># &quot;surface_low_velocity_zone&quot;, &quot;random&quot;, &quot;topography&quot;,</span>
<span class="c1"># &quot;slab&quot;</span>
<span class="n">model_type</span> <span class="o">=</span> <span class="s2">&quot;fault_zone&quot;</span>

<span class="c1"># Receiver locations</span>
<span class="n">irx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">140</span><span class="p">])</span>
<span class="n">irz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">seis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">irx</span><span class="p">),</span> <span class="n">nt</span><span class="p">))</span>

<span class="c1"># Initialize pressure at different time steps and the second</span>
<span class="c1"># derivatives in each direction</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
<span class="n">pold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
<span class="n">pnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
<span class="n">pxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
<span class="n">pzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize velocity model (the fun bit!)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>

<span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;homogeneous&quot;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="n">c0</span>
<span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;fault_zone&quot;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="n">c0</span>
    <span class="n">c</span><span class="p">[:,</span> <span class="n">nx</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">nx</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.8</span>
<span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;surface_low_velocity_zone&quot;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="n">c0</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="mf">0.8</span>
<span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
    <span class="n">pert</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">pert</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="n">c0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;topography&quot;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="n">c0</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">105</span><span class="p">:</span><span class="mi">115</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="mi">145</span><span class="p">:</span><span class="mi">170</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span> <span class="mi">50</span><span class="p">:</span><span class="mi">105</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.8</span>
<span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;slab&quot;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">+=</span> <span class="n">c0</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">110</span><span class="p">:</span><span class="mi">125</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">125</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.4</span> <span class="o">*</span> <span class="n">c0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="mi">180</span><span class="p">):</span>
        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.4</span> <span class="o">*</span> <span class="n">c0</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<span class="n">cmax</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Source time function Gaussian, nt + 1 as we loose the last one by diff</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
    <span class="n">src</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">T</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">it</span> <span class="o">-</span> <span class="n">ist</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Take the first derivative</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span>
<span class="n">src</span><span class="p">[</span><span class="n">nt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot preparation</span>

<span class="n">v</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">max</span><span class="p">())])</span>
<span class="c1"># Initialize animated plot</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">pnew</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">v</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=+</span><span class="n">v</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span>
<span class="p">)</span>


<span class="c1"># Plot the receivers</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">irx</span><span class="p">,</span> <span class="n">irz</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">isx</span><span class="p">,</span> <span class="n">isz</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;ix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;iz&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="c1"># plt.show(block=False)</span>

<span class="c1"># required for seismograms</span>
<span class="n">ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irx</span><span class="p">))</span>

<span class="c1"># Output Courant criterion</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Courant Criterion eps :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cmax</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Courant Criterion eps :
0.3
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/9f7916f93ba683d47bd448a7a1db682cbb063f5a6630fd6be4288efec0c4cdef.png"><img alt="../_images/9f7916f93ba683d47bd448a7a1db682cbb063f5a6630fd6be4288efec0c4cdef.png" src="../_images/9f7916f93ba683d47bd448a7a1db682cbb063f5a6630fd6be4288efec0c4cdef.png" style="width: 527px; height: 437px;" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time extrapolation</span>
<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">nop</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># calculate partial derivatives, be careful around the boundaries</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pzz</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pxx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">nop</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="c1"># calculate partial derivatives, be careful around the boundaries</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">pzz</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
                <span class="o">+</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="o">-</span> <span class="mf">5.0</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nz</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">pxx</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
                <span class="o">+</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="o">-</span> <span class="mf">5.0</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
                <span class="o">+</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
            <span class="p">)</span>

    <span class="n">pxx</span> <span class="o">/=</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pzz</span> <span class="o">/=</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Time extrapolation</span>
    <span class="n">pnew</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="n">pold</span> <span class="o">+</span> <span class="n">dt</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">pxx</span> <span class="o">+</span> <span class="n">pzz</span><span class="p">)</span>
    <span class="c1"># Add source term at isx, isz</span>
    <span class="n">pnew</span><span class="p">[</span><span class="n">isz</span><span class="p">,</span> <span class="n">isx</span><span class="p">]</span> <span class="o">=</span> <span class="n">pnew</span><span class="p">[</span><span class="n">isz</span><span class="p">,</span> <span class="n">isx</span><span class="p">]</span> <span class="o">+</span> <span class="n">src</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>

    <span class="c1"># Plot every isnap-th iteration</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">it</span> <span class="o">%</span> <span class="n">isnap</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">):</span>  <span class="c1"># you can change the speed of the plot by increasing the plotting interval</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Max P: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">image</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">pnew</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">pold</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">pnew</span>

    <span class="c1"># Save seismograms</span>
    <span class="n">seis</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span> <span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">irz</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span> <span class="n">irx</span><span class="p">[</span><span class="n">ir</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/fda10cf466a8648fae72638d0400ee1aa19f6d6430579db72f8d264288f71e85.png"><img alt="../_images/fda10cf466a8648fae72638d0400ee1aa19f6d6430579db72f8d264288f71e85.png" src="../_images/fda10cf466a8648fae72638d0400ee1aa19f6d6430579db72f8d264288f71e85.png" style="width: 558px; height: 434px;" /></a>
</div>
</div>
<p>The cell below allows you to plot source time function, seismic velocites, and the resulting seismograms in windows inside the notebook. Remember to rerun after you simulated again!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the source time function and the seismograms</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Source time function&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s) &quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Source amplitude &quot;</span><span class="p">)</span>

<span class="c1"># plt.subplot(222)</span>
<span class="c1"># ymax = seis.ravel().max()</span>
<span class="c1"># for ir in range(len(seis)):</span>
<span class="c1">#    plt.plot(time, seis[ir, :] + ymax * ir)</span>
<span class="c1">#    plt.xlabel(&#39;Time (s)&#39;)</span>
<span class="c1">#    plt.ylabel(&#39;Amplitude&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="n">seis</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seis</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">seis</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">ymax</span> <span class="o">*</span> <span class="n">ir</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="c1"># The velocity model is influenced by the Earth model above</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Velocity Model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;ix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;iz&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/63572014a1a27ae1b79fe3d9b98213a184da496d98ab5cdb1afe407d98163002.png"><img alt="../_images/63572014a1a27ae1b79fe3d9b98213a184da496d98ab5cdb1afe407d98163002.png" src="../_images/63572014a1a27ae1b79fe3d9b98213a184da496d98ab5cdb1afe407d98163002.png" style="width: 715px; height: 700px;" /></a>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./waves"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="W4_ac1d_optimal_operators.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">32. </span>Acoustic Waves 1D - Optimal Operators</p>
      </div>
    </a>
    <a class="right-next"
       href="W4_fd_ac2d_homogeneous.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">34. </span>Acoustic Waves 2D - Homogeneous case</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-equations">33.1. Basic Equations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">33.1.1. 1. Getting started</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability">33.1.2. 2. Stability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-order-operators">33.1.3. 3. High-order operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-anisotropy">33.1.4. 4. Numerical anisotropy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#heterogeneous-models">33.1.5. 5. Heterogeneous models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#source-receiver-reciprocity">33.1.6. 6. Source-receiver reciprocity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-reversal">33.1.7. 7. Time reversal</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Carlos Aznarán
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright February 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Jun 03, 2024.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
    This webpage is distributed under the terms of the
    <a href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>
    which permits use, duplication, adaptation, distribution and
    reproduction in any medium or format, as long as you give appropriate
    credit to the original author(s) and the source, provide a link to the Creative
    Commons license and indicate if changes were made.
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>